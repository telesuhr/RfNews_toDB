# NY市場サマリーニュース取得検証結果

**検証日時**: 2025年10月19日
**検証期間**: 2025年10月12日 ～ 2025年10月19日（過去7日間）

## 検証結果サマリー

✅ **NY市場サマリーニュースは正常に取得できています**

- 過去7日間で**7件のNY市場サマリーニュース**を取得
- すべてのニュースで`NY_MARKET`カテゴリが正しく検出されている
- 複数の検索パターン（全角・半角・大文字・小文字）すべてで取得可能

## テスト1: NY_MARKETカテゴリで検索

### 検索条件
- カテゴリ: `NY_MARKET`
- 検索クエリ: `ＮＹ市場サマリー`（全角カタカナ）
- 期間: 2025-10-12 ～ 2025-10-19
- 取得件数: 20件（上限）

### 取得結果

**取得成功: 7件**

| No | ヘッドライン | 発行日時 | ソース | 検出カテゴリ |
|----|------------|----------|--------|-------------|
| 1 | ＮＹ市場サマリー（17日）ドル週間で下落、利回り上昇　株反発 | 2025-10-17 21:16:37+00:00 | Reuters | NY_MARKET |
| 2 | UPDATE 1-ＮＹ市場サマリー（16日）米国株下落、ドル下落、2年債利回り3年超ぶり低水準 | 2025-10-16 21:44:42+00:00 | Reuters | NY_MARKET |
| 3 | ＮＹ市場サマリー（16日）米国株下落、ドル下落、2年債利回り3年超ぶり低水準 | 2025-10-16 21:19:56+00:00 | Reuters | NY_MARKET |
| 4 | ＮＹ市場サマリー（15日）Ｓ＆Ｐ５００反発、ドルが対ユーロ・円で下落、利回り上昇 | 2025-10-15 21:42:32+00:00 | Reuters | NY_MARKET |
| 5 | ＮＹ市場サマリー（14日）米国株まちまち、ドル下落・利回り低下　米中貿易摩擦懸念 | 2025-10-14 21:37:42+00:00 | Reuters | NY_MARKET |
| 6 | UPDATE 1-ＮＹ市場サマリー（13日）米国株大幅反発、ドル上昇　米中貿易巡る懸念緩和 | 2025-10-13 21:30:31+00:00 | Reuters | NY_MARKET |
| 7 | ＮＹ市場サマリー（13日）米国株大幅反発、ドル上昇　米中貿易巡る懸念緩和 | 2025-10-13 21:09:37+00:00 | Reuters | NY_MARKET |

### 特徴

- ✅ すべてReutersからの配信
- ✅ 毎営業日、日本時間で21:00～22:00頃に配信
- ✅ ヘッドラインは必ず「ＮＳ市場サマリー（日付）」で始まる
- ✅ 一部のニュースには`UPDATE 1-`というプレフィックスが付く（更新版）

## テスト2: 複数の検索パターンで検証

すべての表記パターンで正常に取得できることを確認しました。

| 検索パターン | 説明 | 取得結果 | サンプル |
|------------|------|---------|---------|
| `ＮＹ市場サマリー` | 全角カタカナ | ✅ 5件 | ＮＹ市場サマリー（17日）ドル週間で下落... |
| `NY市場サマリー` | 半角英字 + 漢字 | ✅ 5件 | ＮＹ市場サマリー（17日）ドル週間で下落... |
| `ny市場サマリー` | 小文字 | ✅ 5件 | ＮＹ市場サマリー（17日）ドル週間で下落... |
| `ＮＹ市場` | 短縮版（全角） | ✅ 5件 | ＮＹ市場サマリー（17日）ドル週間で下落... |
| `NY市場` | 短縮版（半角） | ✅ 5件 | ＮＹ市場サマリー（17日）ドル週間で下落... |

**結論**: Refinitiv APIは表記揺れに対して柔軟に検索できる

## テスト3: カテゴリ検出ロジックの確認

現在の検出ロジック（`news_fetcher.py:264-266`）:
```python
if re.search(r'(ny市場サマリー|ＮＹ市場サマリー|ｎｙ市場サマリー|NY市場サマリー)', headline, re.IGNORECASE):
    if 'NY_MARKET' not in categories_found:
        categories_found.append('NY_MARKET')
```

### 検出結果

| テストケース | マッチ結果 |
|------------|-----------|
| `ＮＹ市場サマリー（１６日）` | ✅ マッチ |
| `NY市場サマリー（１６日）` | ✅ マッチ |
| `ny市場サマリー（１６日）` | ✅ マッチ |
| `ＮＹ株式市場の動向` | ❌ マッチなし（正常） |
| `NYダウ、最高値更新` | ❌ マッチなし（正常） |

**結論**: 検出ロジックは正確に動作している

## 現在の実装状況

### 検索クエリ設定（`news_fetcher.py:355`）

```python
category_queries = {
    # ...
    'NY_MARKET': 'ＮＹ市場サマリー'
}
```

✅ **全角カタカナ表記で正常に動作**

### カテゴリ検出（`news_fetcher.py:264-266`）

ヘッドラインから以下のパターンを検出:
- `ny市場サマリー`
- `ＮＹ市場サマリー`
- `ｎｙ市場サマリー`
- `NY市場サマリー`

✅ **複数の表記パターンに対応**

### スケジューラー設定（`scheduler.py:109, 177`）

定期実行ジョブのカテゴリリストに`NY_MARKET`が含まれている:

```python
target_categories = [
    'COPPER', 'ALUMINIUM', 'ZINC', 'LEAD', 'NICKEL', 'TIN',
    'EQUITY', 'FOREX', 'COMMODITIES',
    'NY_MARKET'  # ← 含まれている
]
```

✅ **スケジューラーでも取得対象に含まれている**

## 推奨される使用方法

### 1. コマンドラインで取得

```bash
# 過去7日間のNY市場サマリーを取得
python main.py fetch \
  --category NY_MARKET \
  --count 20

# 特定期間を指定
python main.py fetch \
  --category NY_MARKET \
  --start-date "2025-01-01T00:00:00" \
  --end-date "2025-10-19T23:59:59" \
  --count 500

# バックフィル（過去データ取得）
python main.py fetch-backfill \
  --category NY_MARKET \
  --start-date "2025-01-01T00:00:00" \
  --per-page 100
```

### 2. スケジューラーで自動取得

スケジューラーは以下のタイミングでNY市場サマリーを自動取得します:

- **リアルタイム取得**: 5分間隔（最新1時間分）
- **日次バッチ**: 毎日午前3時（前日分）

```bash
# スケジューラー起動
python src/scheduler.py --daemon

# 単発実行（テスト用）
python src/scheduler.py --job latest
python src/scheduler.py --job daily
```

## 注意事項

### 1. 配信タイミング

NY市場サマリーは**日本時間で21:00～22:00頃**に配信されるため:

- リアルタイム取得（5分間隔）でほぼ確実に取得できる
- 日次バッチ（午前3時）でも取得できる

### 2. 重複記事

同じ日のNY市場サマリーに複数のバージョンが存在する場合があります:

- 初版: `ＮＹ市場サマリー（日付）...`
- 更新版: `UPDATE 1-ＮＹ市場サマリー（日付）...`

`story_id`が異なるため、どちらも格納されます（重複ではない）。

### 3. 言語フィルタ

NY市場サマリーは**日本語のみ**で配信されるため、言語フィルタは不要です:

```bash
# 言語フィルタなしで十分
python main.py fetch --category NY_MARKET

# 明示的に指定する場合
python main.py fetch --category NY_MARKET --language ja
```

## 結論

✅ **NY市場サマリーニュースは完全に取得可能**

- 検索クエリ: 正常動作
- カテゴリ検出: 正確
- スケジューラー: 対応済み
- 取得実績: 過去7日間で7件取得

**現在の実装で問題なく運用可能です。**

## 今後の改善案（オプション）

現在の実装で十分に機能していますが、さらに精度を高める場合:

### 1. 検出パターンの拡張

```python
# より厳密なパターンマッチング
pattern = r'\b(ＮＹ|NY|ｎｙ|ny)市場サマリー'
```

### 2. ソースフィルタの追加

NY市場サマリーはReutersのみから配信されるため:

```python
if source == 'Reuters' and 'NY市場サマリー' in headline:
    categories_found.append('NY_MARKET')
```

### 3. 優先度スコアの設定

重要なサマリーニュースとして高い優先度を付与:

```json
{
  "news_filtering": {
    "priority_scoring": {
      "keywords": {
        "high_priority": {
          "score": 10,
          "terms": ["NY市場サマリー", "ＮＹ市場サマリー"]
        }
      }
    }
  }
}
```

ただし、**現状の実装で十分に機能しているため、これらの改善は必須ではありません**。
